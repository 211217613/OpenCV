
/*
g++ -Wall -o salida E7_1.cpp `pkg-config --cflags --libs opencv`

*/

#include<iostream>

#include<opencv2/core/core.hpp>
#include<opencv2/ml/ml.hpp>
#include<opencv/cv.h>
#include<opencv2/imgproc/imgproc.hpp>
#include<opencv2/highgui/highgui.hpp>

#include <stdio.h>    
#include <stdlib.h> 
#include <stdint.h>   
#include <string.h>   
#include <unistd.h>   
#include <fcntl.h>   
#include <errno.h>    
#include <termios.h>  
#include <sys/ioctl.h>
#include <getopt.h>

using namespace std;

using namespace cv;
Mat plantilla;
Mat camara;
Mat LEDON = imread("on.png", CV_LOAD_IMAGE_COLOR);
Mat LEDOFF = imread("off.png", CV_LOAD_IMAGE_COLOR);
int incremento=0;
static void CuandoELRatonSeMueve( int event, int x, int y, int, void* )
{
	char nombre[20];
	
	Rect roi2(Point(118,82), Size(50, 50));
	switch(event)
	{
	case CV_EVENT_LBUTTONDOWN:    
	if(x >= 14 && x <= 133 && y >= 178 && y<=236)
	{
		cout << "LED OFF" << endl;
putText(plantilla,"LED ON",Point(53,276),FONT_HERSHEY_PLAIN, 2,Scalar(255,255,255),1);
putText(plantilla,"LED OFF",Point(53,276),FONT_HERSHEY_PLAIN, 2,Scalar(255,0,0),1);
	LEDOFF.copyTo(plantilla(roi2));

	}
	if(x >= 145 && x <= 263 && y >= 178 && y<=237)
	{
putText(plantilla,"LED OFF",Point(53,276),FONT_HERSHEY_PLAIN, 2,Scalar(255,255,255),1);
putText(plantilla,"LED ON",Point(53,276),FONT_HERSHEY_PLAIN, 2,Scalar(255,0,0),1);
		cout << "LED OFF" << endl;
	LEDON.copyTo(plantilla(roi2));
	}
		

if(x >= 46 && x <= 225 && y >= 297 && y<=358)
	{
		sprintf(nombre,"Guarda%i.png", incremento);
		incremento++;

		cout << "GUARDAR" << endl;
		imwrite(nombre, camara);

	}
		break;
	
	}
}


int main(void)
{
	Mat camara_chica;
	char variable[4] = {'1','0','2','3'};
	VideoCapture cam(0);
	if(!cam.isOpened()) return -1;
	

	plantilla = imread("Plantilla.png", CV_LOAD_IMAGE_COLOR);
	namedWindow("Sistema");
putText(plantilla,"PRACTICA 5",Point(30,30),FONT_HERSHEY_PLAIN, 2,Scalar(0,255,0),1, CV_AA);

putText(plantilla,"Camara 1",Point(306,287),FONT_HERSHEY_PLAIN, 3,Scalar(0,0,0),1, CV_AA);
	setMouseCallback( "Sistema", CuandoELRatonSeMueve, 0 );

	//(Region Of Interest)
	Rect roi(Point(278,6), Size(320, 240));
	


	for(;;)
	{
		cam >> camara;
	resize(camara, camara_chica, Size(320, 240), 0, 0, INTER_CUBIC);
		
		camara_chica.copyTo(plantilla(roi));
		imshow("Sistema", plantilla);
putText(plantilla,"ADC 1: ",Point(284,384),FONT_HERSHEY_PLAIN, 2,Scalar(0,0,0),1, CV_AA);

putText(plantilla,variable,Point(437,384),FONT_HERSHEY_PLAIN, 2,Scalar(0,0,0),1, CV_AA);

		if(waitKey(30)>0) break;
	}


}
	


